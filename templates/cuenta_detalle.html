<!doctype html>
<html lang="es">
<head>
    <title>Restaurante - Cuenta Mesa {{ mesa.numero }}</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="container mt-3">
    <h2>Cuenta - Mesa {{ mesa.numero }}</h2>
    <!-- Detalle de pedidos entregados -->
    {% if detalle_pedidos %}
      {% for entry in detalle_pedidos %}
        <h4>Pedido {{ entry.pedido.codigo }} - Subtotal: ${{ entry.subtotal }}</h4>
        <ul>
          {% for item in entry.pedido.platos.all %}
            <li>{{ item.cantidad }} x {{ item.plato.nombre }} - ${{ item.plato.precio * item.cantidad }}</li>
          {% endfor %}
        </ul>
      {% endfor %}
      <hr/>
      <h3>Total consumido: ${{ total_general|floatformat:2 }}</h3>
      {% if descuento %}
        <h4>Descuento aplicado: {{ descuento }}% – Total con descuento: ${{ total_con_descuento|floatformat:2 }}</h4>
      {% endif %}
      {% if num_personas %}
        <h4>Dividido entre {{ num_personas }} personas: ${{ total_por_persona|floatformat:2 }} por persona</h4>
      {% endif %}
      <!-- Formulario para aplicar descuento o dividir cuenta -->
      <form method="get" class="mt-3">
        <div class="row mb-2">
          <div class="col">
            <label class="form-label">Descuento (%):</label>
            <input type="number" name="descuento" class="form-control" value="{{ descuento|default:0 }}">
          </div>
          <div class="col">
            <label class="form-label">Dividir entre personas:</label>
            <input type="number" name="personas" class="form-control" value="{{ num_personas|default:'' }}">
          </div>
          <div class="col d-flex align-items-end">
            <button type="submit" class="btn btn-secondary">Recalcular</button>
          </div>
        </div>
      </form>
      <button class="btn btn-primary">Generar boleta/factura</button>
    {% else %}
      <p>No hay pedidos entregados para esta mesa aún.</p>
    {% endif %}
</body>
</html>
